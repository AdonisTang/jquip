$.plug("ajax",function($){function _xhr(){if(_xhrf!=null)return _xhrf();for(var a=0,b=xhrs.length;a<b;a++)try{var c=xhrs[a],d=c();if(d!=null)return _xhrf=c,d}catch(e){}return function(){}}function _xhrResp(xhr,dataType){dataType=dataType||xhr.getResponseHeader("Content-Type").split(";")[0];switch(dataType){case"text/xml":return xhr.responseXML;case"json":case"text/json":case"application/json":case"text/javascript":case"application/javascript":case"application/x-javascript":return window.JSON?window.JSON.parse(xhr.responseText):eval(xhr.responseText);default:return xhr.responseText}}function ajax(a){var b=_xhr(),c,d=0;a=$._defaults(a,{userAgent:"XMLHttpRequest",lang:"en",type:"GET",data:null,contentType:"application/x-www-form-urlencoded",dataType:"application/json"}),a.timeout&&(c=setTimeout(function(){b.abort(),a.timeoutFn&&a.timeoutFn(a.url)},a.timeout));var e=$(a.context||document),f=e;b.onreadystatechange=function(){if(b.readyState==4){c&&clearTimeout(c);if(b.status<300){var g=_xhrResp(b,a.dataType);a.success&&a.success(g),f.trigger("ajaxSuccess",[b,g,a])}else a.error&&a.error(b,b.status,b.statusText),f.trigger(e,"ajaxError",[b,b.statusText,a]);a.complete&&a.complete(b,b.statusText),f.trigger(e,"ajaxComplete",[b,a])}else a.progress&&a.progress(++d)};var g=a.url,h=null,i=a["type"]=="POST"||a["type"]=="PUT";!i&&a.data&&(g+="?"+formData(a.data)),b.open(a.type,g);if(i){var j=a.dataType.indexOf("json")>=0;h=j?JSON.stringify(a.data):formData(a.data),b.setRequestHeader("Content-Type",j?"application/json":"application/x-www-form-urlencoded")}b.send(h)}var xhrs=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("MSXML2.XMLHTTP.3.0")},function(){return new ActiveXObject("MSXML2.XMLHTTP")}],_xhrf=null;$.xhr=_xhr,$._xhrResp=_xhrResp,$.formData=function(a){var b=[],c=/%20/g;for(var d in a)b.push(encodeURIComponent(d).replace(c,"+")+"="+encodeURIComponent(a[d].toString()).replace(c,"+"));return b.join("&")},$.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){$.fn[b]=function(a){return this.bind(b,a)}}),$.ajax=ajax,$.getJSON=function(a,b,c,d){$.isFunction(b)&&(d=c,c=b,b=null),ajax({url:a,data:b,success:c,dataType:"json"})},$.get=function(a,b,c,d){$.isFunction(b)&&(d=c,c=b,b=null),ajax({url:a,type:"GET",data:b,success:c,dataType:d||"text/plain"})},$.post=function(a,b,c,d){$.isFunction(b)&&(d=c,c=b,b=null),ajax({url:a,type:"POST",data:b,success:c,dataType:d||"text/plain"})},win.JSON||$.loadAsync("http://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js")})